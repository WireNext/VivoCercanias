name: Actualización Diaria GTFS Estático

on:
  # 1. Tarea programada: Ejecuta el script todos los días a las 05:00 AM (UTC)
  schedule:
    - cron: '0 5 * * *' 
  # 2. Desencadenador manual: Permite ejecutarlo manualmente desde la pestaña 'Actions'
  workflow_dispatch:

jobs:
  ingest_static_data:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Código
        uses: actions/checkout@v4
        
      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          
      - name: Instalar Dependencias del Backend
        # Instala las dependencias necesarias para la ingesta (incluyendo pandas y psycopg2)
        run: pip install -r backend/requirements.txt
        
      - name: Ejecutar Script de Ingesta (gtfs_ingestor.py)
        # El script descarga el ZIP de Renfe y lo carga en la DB
        env:
          # Utiliza el Secreto de GitHub para la URL de conexión a tu PostgreSQL
          DATABASE_URL: ${{ secrets.POSTGRES_URL }}
        run: python backend/gtfs_ingestor.py
        
      - name: Notificación de Éxito
        # (Opcional) Puedes añadir un paso aquí para enviar un mensaje a Slack/Email si la carga tiene éxito.
        run: echo "Carga de GTFS estático completada."